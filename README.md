# PracticalWork2021

Experimental project to use Large Language models, trained for program synthesis, to solve math world problems.

## CodeGen

See [the CodeGen GithubRepo](https://github.com/salesforce/CodeGen) for more details on the model and how to download it.

### Prompting Strategy

Typical prompting strategy and expected completion when using CodeGen. The prompt stops at the new line after the function's docstrings

```python
def exercise2():
    """
    Sue works in a factory and every 30 minutes, a machine she oversees produces 30 cans of soda. How many cans of soda can one machine produce in 8 hours?
    """
    cans_per_30_minutes = 30
    cans_per_minute = cans_per_30_minutes / 30
    cans_per_hour = cans_per_minute * 60
    cans_per_8_hours = cans_per_hour * 8
    return float(cans_per_8_hours)
```

### Hardware Requirements

To reproduce many of the results in the paper, you will need a GPU with at least 48GB of memory. [DataCrunch](https://cloud.datacrunch.io) offers the A6000.

### Clustering Experiments

The clustering experiments attempt to customize the few-shot prompts based on the problem using kNN clustering on sentence embeddings. The clustering experiments are in the `clustering_experiments` folder.

### Concepts Experiemnts

The concepts experiments attempt to customize the few-shot prompts based on the problem using the concepts from [Mapping to Declarative Knowledge for Word Problem Solving by Subhro Roy and Dan Roth](https://aclanthology.org/Q18-1012.pdf). The concepts experiments are in the `concepts_experiments` folder.

### Conversational Experiments

Step 1 of the conversational prompting strategy. The main question is removed and comments are added for more incremental questions. The prompt for step 1 includes the comment after the docstring.

```python

def exercise2():
    """
    Sue works in a factory and every 30 minutes, a machine she oversees produces 30 cans of soda.
    """
    #How many sets of 30 minutes are there in 8 hours?
    sets_per_hour = 2
    sets_per_8_hours = 8*sets_per_hour
    return float(sets_per_8_hours)
```

Step 2 of the conversational prompting strategy removes step 1's question in the last comment and adds to the prompt a new question after the code generated by the model.

```python
def exercise2():
    """
    Sue works in a factory and every 30 minutes, a machine she oversees produces 30 cans of soda.
    """
    sets_per_hour = 2
    sets_per_8_hours = 8*sets_per_hour
    #How many cans of soda can one machine produce in 8 hours?
    cans_per_set = 30
    cans_per_8_hours = cans_per_set * sets_per_8_hours
    return float(cans_per_8_hours)
```
